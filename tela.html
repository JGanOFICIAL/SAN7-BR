<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Caixa - Sistema de Loja</title>
<style>
:root{--white:#fff;--black:#000;--yellow:#ffd500;--gray:#f7f7f7;--border:#e0e0e0}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Poppins',sans-serif}
body{background:var(--gray);color:var(--black)}
header{position:fixed;top:0;left:0;width:100%;background:var(--white);box-shadow:0 2px 8px rgba(0,0,0,0.08);display:flex;align-items:center;justify-content:space-between;padding:12px 22px;z-index:20}
header img{height:44px}
header .botoes-topo{display:flex;gap:10px;align-items:center}
header .saldo{font-weight:600;font-size:1rem}
main{margin-top:92px;padding:18px}
.search-bar{background:var(--white);padding:12px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.04);display:flex;gap:10px;align-items:center}
.search-bar input{flex:1;padding:10px;border:1px solid var(--border);border-radius:8px}
button{background:var(--yellow);border:none;padding:9px 14px;border-radius:8px;cursor:pointer;font-weight:600}
button:hover{opacity:.95}
.produtos{margin-top:18px;display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
.produto{background:var(--white);padding:14px;border-radius:12px;border:1px solid var(--border);display:flex;flex-direction:column;justify-content:space-between;min-height:120px;box-shadow:0 3px 10px rgba(0,0,0,0.03)}
.produto h3{font-size:1rem;margin-bottom:4px}
.produto small{color:#666}
.produto .precos{border-top:1px solid var(--border);margin-top:10px;padding-top:10px;display:flex;flex-direction:column;gap:6px}
.produto .preco-line{display:flex;justify-content:space-between;align-items:center;padding:6px;border-radius:8px;background:#fbfbfb;border:1px solid #f0f0f0}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;justify-content:center;align-items:center;z-index:40}
.modal-content{background:var(--white);width:92%;max-width:440px;padding:18px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.18);position:relative}
.modal-content h2{text-align:center;margin-bottom:12px;font-size:1.05rem}
.modal-content input{width:100%;padding:10px;border:1px solid var(--border);border-radius:8px;margin-bottom:10px}
.modal-content .close{position:absolute;right:12px;top:10px;font-size:20px;cursor:pointer;color:#444}
.modal-precos{display:flex;flex-direction:column;gap:12px;margin-top:8px}
.modal-precos .box{border:1px solid var(--border);padding:10px;border-radius:8px;background:#fbfbfb;display:flex;justify-content:space-between;align-items:center}
.venda-item{background:#fafafa;border:1px solid #eee;padding:10px;border-radius:8px;margin-bottom:8px}
.info-empty{text-align:center;color:#777;padding:25px;background:var(--white);border-radius:10px;border:1px dashed #eee;margin-top:16px}
#carrinhoBtn{position:fixed;bottom:20px;right:20px;background:var(--black);color:#fff;border:none;padding:12px 20px;border-radius:50px;cursor:pointer;font-weight:700;z-index:100}
#carrinhoQtd{background:red;color:#fff;border-radius:50%;padding:2px 7px;margin-left:6px;font-size:.8rem}
#carrinhoModal .itens{max-height:50vh;overflow:auto;margin-top:10px}
#cupomFiscal{display:none}
@media print{
body *{visibility:hidden}
#cupomFiscal,#cupomFiscal *{visibility:visible}
#cupomFiscal{position:absolute;left:0;top:0;width:100%}
}
#cupomFiscal{background:#fff;color:#000;border:1px dotted rgba(0,0,0,0.3);padding:20px;width:100%;max-width:400px;margin:auto}
#cupomFiscal h2{text-align:center;border-bottom:1px dotted rgba(0,0,0,0.4);padding-bottom:8px;margin-bottom:8px}
#cupomFiscal table{width:100%;border-collapse:collapse;margin-bottom:10px}
#cupomFiscal td{padding:4px 0;border-bottom:1px dotted rgba(0,0,0,0.2)}
#cupomFiscal .rodape{text-align:center;border-top:1px dotted rgba(0,0,0,0.4);padding-top:8px;font-size:.9rem}
</style>
</head>
<body>
<header>
<img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhjzHjhTIyqYoSZG8vev_6LnCfbU-ZtiuhmnwF4mg4tIpnRPqwGAJBeOLqDvNfjG1kr7f-XoHQAH6RuJZtIIZcYRud3Mj7MPslOGrhf9BVhGEpXH0JosziwhF2bEx6OLz6-6MI6IfuzyDOKuh_O_iDeGrz0pGc_UFZaXIB4Er6_wuzA1I8YFtgnfXgmjTg/s665/C7D9E909-0047-48E4-AC64-B95B76114751.jpeg">
<div class="botoes-topo">
<span class="saldo">Saldo: R$ <span id="saldoValor">0.00</span></span>
<button id="editarVendasBtn">Editar</button>
<button id="finalizarDiaBtn">Finalizar Dia</button>
</div>
</header>
<main>
<div class="search-bar">
<input id="searchInput" placeholder="Pesquisar por nome ou marca...">
<button id="cadastroProdutoBtn">Cadastrar Produto</button>
</div>
<div id="listaProdutos" class="produtos"></div>
</main>
<button id="carrinhoBtn">Carrinho <span id="carrinhoQtd">0</span></button>
<div id="modalCadastro" class="modal"><div class="modal-content"><span id="closeCadastro" class="close">&times;</span><h2>Cadastrar Produto</h2><input id="nomeProduto" placeholder="Nome do Produto"><input id="marcaProduto" placeholder="Marca (opcional)"><input id="precoAvista" type="number" step="0.01" placeholder="Preço à vista"><input id="precoCartao" type="number" step="0.01" placeholder="Preço no cartão"><button id="salvarProduto">Salvar Produto</button></div></div>
<div id="modalEditar" class="modal"><div class="modal-content"><span id="closeEditar" class="close">&times;</span><h2>Vendas Realizadas</h2><div id="listaVendas" style="margin-top:12px;max-height:60vh;overflow:auto"></div><div style="margin-top:12px;text-align:center"><button id="fecharEditar">Fechar</button></div></div></div>
<div id="carrinhoModal" class="modal"><div class="modal-content"><span id="closeCarrinho" class="close">&times;</span><h2>Carrinho</h2><div class="itens" id="carrinhoItens"></div><div style="margin-top:10px;text-align:center"><strong>Total: R$ <span id="carrinhoTotal">0.00</span></strong></div><div style="margin-top:14px;display:flex;gap:10px;justify-content:center"><button id="finalizarVendaBtn">Finalizar</button><button id="cancelarVendaBtn">Cancelar</button></div></div></div>
<div id="cupomFiscal"></div>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig={apiKey:"AIzaSyCAlWxc7YxTMcTLCECUDuYfomO6QapreqY",authDomain:"login-you-see.firebaseapp.com",databaseURL:"https://login-you-see-default-rtdb.firebaseio.com",projectId:"login-you-see",storageBucket:"login-you-see.firebasestorage.app",messagingSenderId:"524877259374",appId:"1:524877259374:web:9ff66b67c9c5bf0bb07c7f",measurementId:"G-K7E00VXYHG"};firebase.initializeApp(firebaseConfig);const db=firebase.database();const saldoValorEl=document.getElementById('saldoValor'),listaProdutosEl=document.getElementById('listaProdutos'),listaVendasEl=document.getElementById('listaVendas');const modalCadastro=document.getElementById('modalCadastro'),modalEditar=document.getElementById('modalEditar');const carrinhoBtn=document.getElementById('carrinhoBtn'),carrinhoModal=document.getElementById('carrinhoModal'),carrinhoItens=document.getElementById('carrinhoItens'),carrinhoQtd=document.getElementById('carrinhoQtd'),carrinhoTotal=document.getElementById('carrinhoTotal');let carrinho=[];
function showModal(m){m.style.display='flex'}
function hideModal(m){m.style.display='none'}
db.ref('saldo').on('value',s=>{saldoValorEl.textContent=Number(s.val()||0).toFixed(2)});
function carregarProdutos(){db.ref('produtos').on('value',snap=>{listaProdutosEl.innerHTML='';if(!snap.exists()){listaProdutosEl.innerHTML='<div class="info-empty">Nenhum produto cadastrado.</div>';return;}snap.forEach(ch=>{const p=ch.val(),id=ch.key;const card=document.createElement('div');card.className='produto';card.innerHTML=`<div><h3>${p.nome}</h3><small>${p.marca||''}</small><div class="precos"><div class="preco-line"><span>À vista</span><strong>R$ ${Number(p.avista).toFixed(2)}</strong></div><div class="preco-line"><span>Cartão</span><strong>R$ ${Number(p.cartao).toFixed(2)}</strong></div></div></div><div class="acao"><button onclick="adicionarCarrinho('${id}','${p.nome}',${p.avista},${p.cartao})">Adicionar</button></div>`;listaProdutosEl.appendChild(card);});});}
carregarProdutos();
document.getElementById('searchInput').addEventListener('input',e=>{const t=e.target.value.toLowerCase();document.querySelectorAll('.produto').forEach(c=>{const n=c.querySelector('h3').textContent.toLowerCase();const m=c.querySelector('small').textContent.toLowerCase();c.style.display=(n.includes(t)||m.includes(t))?'flex':'none'});});
function adicionarCarrinho(id,nome,avista,cartao){carrinho.push({id,nome,avista,cartao});atualizarCarrinho();}
function atualizarCarrinho(){carrinhoQtd.textContent=carrinho.length;let total=0;carrinhoItens.innerHTML='';carrinho.forEach((p,i)=>{total+=p.avista;const div=document.createElement('div');div.innerHTML=`${p.nome} - R$ ${p.avista.toFixed(2)} <button onclick="removerItem(${i})">x</button>`;carrinhoItens.appendChild(div);});carrinhoTotal.textContent=total.toFixed(2);}
function removerItem(i){carrinho.splice(i,1);atualizarCarrinho();}
carrinhoBtn.onclick=()=>showModal(carrinhoModal);
document.getElementById('closeCarrinho').onclick=()=>hideModal(carrinhoModal);
document.getElementById('cancelarVendaBtn').onclick=()=>{if(confirm('Cancelar a venda?')){carrinho=[];atualizarCarrinho();hideModal(carrinhoModal);}};
document.getElementById('finalizarVendaBtn').onclick=async()=>{if(carrinho.length==0)return;const tipo=confirm('Pagamento no cartão? OK=Cartão / Cancel=À vista')?'cartao':'avista';const imprime=confirm('Deseja imprimir a nota?');let total=0;for(const p of carrinho){const valor=tipo==='avista'?p.avista:p.cartao;total+=valor;await db.ref('vendas').push({produto:p.nome,tipo,valor, hora:new Date().toLocaleTimeString(),data:new Date().toLocaleDateString()});const s=await db.ref('saldo').once('value');const a=Number(s.val()||0);await db.ref('saldo').set(Number((a+valor).toFixed(2)));}if(imprime){gerarCupom(carrinho,tipo,total);setTimeout(()=>{window.print()},300);}carrinho=[];atualizarCarrinho();hideModal(carrinhoModal);};
function gerarCupom(lista,tipo,total){const c=document.getElementById('cupomFiscal');const id=Array(18).fill(0).map(()=>Math.random().toString(36)[2]).join('').toUpperCase();const data=new Date();c.innerHTML=`<h2>Ponto Certo JC</h2><div>ID: ${id}</div><div>Data: ${data.toLocaleDateString()} ${data.toLocaleTimeString()}</div><div>Pagamento: ${tipo==='avista'?'À Vista':'Cartão'}</div><table><tbody>${lista.map(p=>`<tr><td>${p.nome}</td><td>R$ ${p.avista.toFixed(2)}</td></tr>`).join('')}</tbody></table><div><strong>Total: R$ ${total.toFixed(2)}</strong></div><div class="rodape">Obrigado pela compra!<br>TEMPO DE TROCA:__________</div>`;c.style.display='block';}
document.getElementById('cadastroProdutoBtn').onclick=()=>showModal(modalCadastro);
document.getElementById('closeCadastro').onclick=()=>hideModal(modalCadastro);
document.getElementById('salvarProduto').onclick=async()=>{const n=document.getElementById('nomeProduto').value.trim();const m=document.getElementById('marcaProduto').value.trim();const a=parseFloat(document.getElementById('precoAvista').value);const c=parseFloat(document.getElementById('precoCartao').value);if(!n||isNaN(a)||isNaN(c))return alert('Preencha corretamente');await db.ref('produtos').push({nome:n,marca:m,avista:a,cartao:c});hideModal(modalCadastro);}
document.getElementById('editarVendasBtn').onclick=async()=>{showModal(modalEditar);listaVendasEl.innerHTML='';const s=await db.ref('vendas').once('value');if(!s.exists()){listaVendasEl.innerHTML='<div class="info-empty">Nenhuma venda.</div>';return;}s.forEach(ch=>{const v=ch.val();const id=ch.key;const d=document.createElement('div');d.className='venda-item';d.innerHTML=`<strong>${v.produto}</strong><small>${v.tipo} - R$ ${v.valor.toFixed(2)}</small><small>${v.hora} • ${v.data}</small><div><button onclick="excluirVenda('${id}',${v.valor})">Excluir</button></div>`;listaVendasEl.appendChild(d);});}
async function excluirVenda(id,valor){if(!confirm('Excluir?'))return;await db.ref('vendas/'+id).remove();const s=await db.ref('saldo').once('value');const a=Number(s.val()||0);await db.ref('saldo').set(Math.max(0,(a-valor)).toFixed(2));document.querySelector(`[onclick="excluirVenda('${id}',${valor})"]`).parentElement.parentElement.remove();}
document.getElementById('fecharEditar').onclick=()=>hideModal(modalEditar);
document.getElementById('closeEditar').onclick=()=>hideModal(modalEditar);
document.getElementById('finalizarDiaBtn').onclick=async()=>{if(!confirm('Finalizar dia?'))return;const v=await db.ref('vendas').once('value');if(!v.exists())return alert('Nenhuma venda.');const vendas=[];v.forEach(ch=>vendas.push(ch.val()));const total=vendas.reduce((s,v)=>s+v.valor,0);const id=db.ref('historicoDias').push().key;await db.ref('historicoDias/'+id).set({data:new Date().toLocaleDateString(),hora:new Date().toLocaleTimeString(),total,vendas});await db.ref('vendas').remove();await db.ref('saldo').set(0);alert('Dia finalizado!');};
</script>
</body>
</html>
