<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dados do Perfil</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary-color: #003366;
  --secondary-color: #0066cc;
  --background-light: #f5f8ff;
  --text-dark: #333;
  --text-light: #fff;
  --border-color: #ddd;
  --button-hover-bg: var(--primary-color);
  --button-hover-text: var(--text-light);
}
body {
  font-family: 'Poppins', sans-serif;
  margin:0; padding:0;
  background: var(--background-light);
  display:flex; flex-direction:column; min-height:100vh; color:var(--text-dark);
}
header {
  position: sticky; top:0; left:0; right:0;
  background: var(--text-light); height:70px; display:flex; align-items:center; justify-content:space-between;
  padding:0 30px; box-shadow:0 4px 12px rgba(0,0,0,0.08); z-index:20;
}
header .logo {
  width:220px; height:45px;
  background-image:url('https://c2a6771173.cbaul-cdnwnd.com/4f0c8b93cda84ae8665e2b589652cf30/200000083-d9fb4d9fb6/700/3F36BE85-5E12-4237-844C-9BD82571F2C4.webp');
  background-repeat:no-repeat; background-size:contain; background-position:left;
}
.header-menu-btn{ cursor:pointer; font-size:32px; color:#000; padding:5px; transition:color 0.3s;}
.header-menu-btn:hover{ color: var(--primary-color);}
#menu{ display:none; position:absolute; right:30px; top:60px; background:var(--text-light); padding:15px 20px; box-shadow:0 4px 15px rgba(0,0,0,0.15); min-width:150px;}
#menu a{ display:block; color: var(--primary-color); text-decoration:none; font-weight:600; padding:5px 0;}
#menu a:hover{ color: var(--secondary-color);}
.main-section{ padding:40px 50px; flex-grow:1; background:var(--text-light);}
.perfil{ display:flex; align-items:center; gap:20px; padding:20px; border:1px solid var(--border-color);}
.perfil img{ width:100px; height:100px; border-radius:50%; border:3px solid var(--secondary-color); object-fit:cover;}
.perfil-info p{ margin:5px 0; font-size:15px;}
#liConcordo{ display:flex; align-items:center; gap:10px; margin:20px 0;}
#liConcordo input{ width:18px; height:18px;}
#baixarBtn{ display:none; width:180px; height:50px; background:var(--primary-color); color:#fff; border:none; cursor:pointer; font-weight:600;}
#baixarBtn:hover{ background: var(--secondary-color);}
.pdf-container{ display:none;}
.pdf-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;}
.pdf-header img{ width:80px; height:80px; border-radius:50%; border:2px solid var(--secondary-color);}
.pdf-body{ border-top:2px solid #003366; padding-top:10px;}
.pdf-row{ display:flex; justify-content:space-between; margin-bottom:8px; border-bottom:1px solid rgba(0,0,0,0.1); padding-bottom:5px;}
.pdf-qr{ margin-top:20px;}
</style>
</head>
<body>
<header>
  <div class="logo"></div>
  <div>
    <div id="menuBtn" class="header-menu-btn">☰</div>
    <div id="menu"><a href="login2.html">Sair</a></div>
  </div>
</header>

<div class="main-section">
  <div class="perfil">
    <img id="fotoPerfil" src="">
    <div class="perfil-info">
      <p><strong>Nome:</strong> <span id="nome"></span></p>
      <p><strong>NA:</strong> <span id="na"></span></p>
      <p><strong>Telefone:</strong> <span id="tel"></span></p>
    </div>
  </div>

  <div id="liConcordo">
    <input type="checkbox" id="concordoCheck"><label for="concordoCheck">Li e concordo com os termos de não compartilhamento dos dados e LGPD.</label>
  </div>

  <button id="baixarBtn">Baixar PDF</button>

  <div class="pdf-container" id="pdfContent">
    <div class="pdf-header">
      <img id="pdfFoto" src="">
      <img src="" id="qrCode" alt="QR Code" style="width:80px;height:80px;">
    </div>
    <div class="pdf-body">
      <div class="pdf-row"><strong>Nome:</strong><span id="pdfNome"></span></div>
      <div class="pdf-row"><strong>NA:</strong><span id="pdfNA"></span></div>
      <div class="pdf-row"><strong>Telefone:</strong><span id="pdfTel"></span></div>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
// Menu toggle
const menuBtn = document.getElementById('menuBtn');
const menu = document.getElementById('menu');
menuBtn.onclick = () => {
  if(menu.style.display==='block'){ menu.style.display='none'; menuBtn.textContent='☰';}
  else{ menu.style.display='block'; menuBtn.textContent='✕';}
};

// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBPiznHCVkTAgx6m02bZB8b0FFaot9UkBU",
  authDomain: "prefeitura-de-joao-camara.firebaseapp.com",
  projectId: "prefeitura-de-joao-camara",
  storageBucket: "prefeitura-de-joao-camara.firebasestorage.app",
  messagingSenderId: "269299041577",
  appId: "1:269299041577:web:fd41b2939240e9eb476338",
  measurementId: "G-YT7NHR342J"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const serie = localStorage.getItem("usuarioAtual");
if(!serie) window.location.href = "login2.html";

const nomeEl = document.getElementById("nome");
const naEl = document.getElementById("na");
const telEl = document.getElementById("tel");
const fotoEl = document.getElementById("fotoPerfil");

const concordoCheck = document.getElementById("concordoCheck");
const baixarBtn = document.getElementById("baixarBtn");

const pdfNome = document.getElementById("pdfNome");
const pdfNA = document.getElementById("pdfNA");
const pdfTel = document.getElementById("pdfTel");
const pdfFoto = document.getElementById("pdfFoto");
const qrCodeEl = document.getElementById("qrCode");

db.ref("usuarios/"+serie).on("value", snap=>{
  if(snap.exists()){
    const d = snap.val();
    nomeEl.textContent = d.nome;
    naEl.textContent = serie;
    telEl.textContent = d.telefone||"—";
    fotoEl.src = d.foto||"";
    pdfNome.textContent = d.nome;
    pdfNA.textContent = serie;
    pdfTel.textContent = d.telefone||"—";
    pdfFoto.src = d.foto||"";
    new QRCode(qrCodeEl,{text:"https://domusfit.site/login2.html", width:80, height:80});
  }
});

concordoCheck.addEventListener('change',()=>{
  baixarBtn.style.display = concordoCheck.checked ? 'block':'none';
});

// Gerar PDF
baixarBtn.addEventListener('click',()=>{
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const foto = pdfFoto.src;
  const nome = pdfNome.textContent;
  const na = pdfNA.textContent;
  const tel = pdfTel.textContent;

  doc.setFontSize(16);
  if(foto) doc.addImage(foto,'JPEG',15,15,30,30);
  doc.text(`Nome: ${nome}`, 15, 60);
  doc.text(`NA: ${na}`, 15, 70);
  doc.text(`Telefone: ${tel}`, 15, 80);

  // QR Code
  const qrCanvas = document.createElement('canvas');
  const qr = new QRCode(qrCanvas,{text:"https://domusfit.site/login2.html", width:60, height:60});
  setTimeout(()=>{
    doc.addImage(qrCanvas.toDataURL('image/png'), 'PNG', 150, 20, 40, 40);
    doc.save(`${nome.replace(/\s+/g,'_')}.pdf`);
  },300);
});
</script>
</body>
</html>
