<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dados do Funcionário</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background: #f5f5f5;
}
header {
    width: 100%;
    background: #0A3D62;
    padding: 15px 20px;
    color: white;
    font-size: 20px;
    font-weight: 600;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-sizing: border-box;
}
header h1 {
    margin: 0;
    font-size: 20px;
    font-weight: 600;
}
#voltarBtn {
    background: white;
    color: #0A3D62;
    border: none;
    padding: 8px 12px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    border-radius: 0;
}
.container {
    width: 90%;
    margin: 30px auto;
    background: white;
    padding: 20px;
    border-radius: 0;
}
.foto-perfil {
    width: 120px;
    height: 120px;
    border-radius: 0;
    object-fit: cover;
    background: #ddd;
}
.linha {
    width: 100%;
    height: 1px;
    background: #ccc;
    margin: 15px 0;
}
.item {
    font-size: 16px;
    margin-bottom: 10px;
}
button {
    width: 100%;
    padding: 12px;
    background: #0A3D62;
    border: none;
    color: white;
    font-size: 16px;
    margin-top: 20px;
    border-radius: 0;
    cursor: pointer;
}
#overlay-confirmacao {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.65);
    display: none;
    justify-content: center;
    align-items: center;
}
.box-confirmacao {
    width: 90%;
    max-width: 350px;
    background: white;
    padding: 20px;
    font-size: 16px;
    border-radius: 0;
}
.box-confirmacao button {
    margin-top: 15px;
    border-radius: 0;
}
</style>
</head>
<body>

<header>
    <h1>Dados do Funcionário</h1>
    



</header>

<div class="container">
    <center>
        <img id="fotoPerfil" class="foto-perfil">
    </center>

    <div class="linha"></div>

    <div class="item"><b>Nome:</b> <span id="nomeFuncionario"></span></div>
    <div class="item"><b>CPF:</b> <span id="cpfFuncionario"></span></div>
    <div class="item"><b>Telefone:</b> <span id="telefoneFuncionario"></span></div>
    <div class="item"><b>NA:</b> <span id="naFuncionario"></span></div>

    <button onclick="abrirConfirmacao()">Baixar Documento</button>
</div>

<div id="overlay-confirmacao">
    <div class="box-confirmacao">
        Estou ciente de que o compartilhamento deste documento é de minha inteira responsabilidade.
        <button onclick="gerarPDF()">Fazer Download</button>
        <button onclick="fecharConfirmacao()" style="background:#555;">Cancelar</button>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<script>
// FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyBPiznHCVkTAgx6m02bZB8b0FFaot9UkBU",
  authDomain: "prefeitura-de-joao-camara.firebaseapp.com",
  projectId: "prefeitura-de-joao-camara",
  storageBucket: "prefeitura-de-joao-camara.firebasestorage.app",
  messagingSenderId: "269299041577",
  appId: "1:269299041577:web:fd41b2939240e9eb476338"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

let dadosUser = {};

auth.onAuthStateChanged(user => {
    if (!user) return;
    db.ref("usuarios/" + user.uid).once("value").then(snap => {
        dadosUser = snap.val();
        document.getElementById("nomeFuncionario").innerText = dadosUser.nome || "";
        document.getElementById("cpfFuncionario").innerText = dadosUser.cpf || "";
        document.getElementById("telefoneFuncionario").innerText = dadosUser.telefone || "";
        document.getElementById("naFuncionario").innerText = dadosUser.na || "";
        document.getElementById("fotoPerfil").src = dadosUser.foto || "https://via.placeholder.com/120";
    });
});

function abrirConfirmacao(){
    document.getElementById("overlay-confirmacao").style.display = "flex";
}
function fecharConfirmacao(){
    document.getElementById("overlay-confirmacao").style.display = "none";
}

async function gerarPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: "mm", format: "a4" });

    doc.setFillColor(235,235,235);
    doc.rect(10,10,190,277,"F");

    doc.setFontSize(20);
    doc.text("Documento do Funcionário", 60, 25);

    const foto = document.getElementById("fotoPerfil").src;
    const img = await toDataURL(foto);
    doc.addImage(img, "JPEG", 20, 40, 40, 40);

    doc.setFontSize(14);
    doc.text("Nome: " + (dadosUser.nome || ""), 20, 95);
    doc.text("CPF: " + (dadosUser.cpf || ""), 20, 110);
    doc.text("Telefone: " + (dadosUser.telefone || ""), 20, 125);
    doc.text("NA: " + (dadosUser.na || ""), 20, 140);

    const qrCanvas = document.createElement("canvas");
    await QRCode.toCanvas(qrCanvas, "https://domusfit.site/login2.html");
    const qrData = qrCanvas.toDataURL("image/png");
    doc.addImage(qrData, "PNG", 140, 40, 50, 50);

    doc.save((dadosUser.nome || "Documento") + ".pdf");
}

function toDataURL(url){
    return fetch(url)
        .then(res => res.blob())
        .then(blob => new Promise((resolve)=>{
            const reader = new FileReader();
            reader.onloadend = ()=> resolve(reader.result);
            reader.readAsDataURL(blob);
        }));
}
</script>

</body>
</html>