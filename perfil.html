<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Prefeitura de João Câmara — Perfil</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Rawline:wght@400;600;700&family=Public+Sans:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{--gov-azul:#1351B4;--gov-amarelo:#FFCD00;--gov-branco:#fff;--gov-verde:#168821;--cinza:#f6f7f9;--sombra:0 10px 30px rgba(0,0,0,.08)}
  body{margin:0;background:var(--cinza);color:#1f1f1f;font-family:"Public Sans","Rawline",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  header{position:sticky;top:0;background:var(--gov-azul);color:#fff;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;box-shadow:var(--sombra);z-index:10}
  .esq{display:flex;align-items:center;gap:12px}
  .logo{width:44px;height:44px;background:#fff;border-radius:6px}
  .saud{display:flex;flex-direction:column}
  .saud strong{font-size:18px}
  .btn{display:inline-flex;align-items:center;justify-content:center;padding:12px 14px;border:none;border-radius:12px;font-weight:700;cursor:pointer}
  .btn-sair{background:#eaf1ff;color:#0b2b6b}
  main{max-width:1040px;margin:24px auto;padding:0 16px}
  .cards{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  @media (max-width:900px){.cards{grid-template-columns:1fr}}
  .card{background:var(--gov-branco);border-radius:12px;box-shadow:var(--sombra);padding:20px}
  .acoes{display:flex;gap:10px;flex-wrap:wrap}
  .btn-acao{background:var(--gov-verde);color:#fff}
  .btn-acao.sec{background:#fffae6;color:#584300;border:1px solid #ffe08a}
  .link{display:inline-flex;align-items:center;gap:8px;text-decoration:none}
  /* Modal */
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.42);display:none;align-items:center;justify-content:center;padding:12px;z-index:50}
  .modal{
    width:min(720px,100%);max-height:80vh;overflow:auto;background:#fff;border-radius:16px;box-shadow:var(--sombra);padding:18px 18px 22px
  }
  .mhead{display:flex;align-items:center;justify-content:space-between;gap:8px;position:sticky;top:0;background:#fff}
  .mclose{border:none;background:#f1f3f5;border-radius:10px;padding:10px;cursor:pointer;font-weight:700}
  label{font-weight:600}
  input{width:100%;padding:12px;border:1px solid #dfe3eb;border-radius:12px;font-size:16px;outline:none}
  input:focus{border-color:#b9c6e2;box-shadow:0 0 0 4px rgba(19,81,180,.12)}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:700px){.grid{grid-template-columns:1fr}}
  .btn-save{background:var(--gov-azul);color:#fff}
  .spinner{width:18px;height:18px;border:3px solid rgba(255,255,255,.4);border-top-color:#fff;border-radius:50%;animation:spin 1s linear infinite;margin-right:8px}
  @keyframes spin{to{transform:rotate(360deg)}}
  .chip{display:inline-block;background:#eaf1ff;color:#0b2b6b;border-radius:999px;padding:6px 10px;font-size:12px;border:1px solid #d6e4ff}
</style>
</head>
<body>
  <header>
  <div class="esq">
    <div class="logo">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQpN6mG9JrV3AvmACLq0uOQb0OcGFLu4WW8sOckbZpA8ow2biqC-IxosxA&s=10" alt="Logomarca" style="max-width:100%;max-height:100%;object-fit:contain;border-radius:6px;display:block;margin:auto;">
    </div>
    <div class="saud">
      <small>Prefeitura de João Câmara/RN</small>
      <strong id="saudacao">Olá!</strong>
    </div>
  </div>
</header>
  <main>
    <div class="cards">
      <section class="card">
        <h2 style="margin:0 0 6px">Minha área</h2>
        <div class="acoes" style="margin-top:8px">
          <button id="btnDados" class="btn btn-acao">Editar dados</button>
          <a class="btn btn-acao sec link" href="https://joaocamara.rn.gov.br" id="btnEventos">Eventos municipais</a>
          <a class="btn btn-acao sec link" href="https://joaocamara.rn.gov.br/?s=Editais" id="btnEditais">Editais</a>
          <a class="btn btn-acao sec link" href="https://joaocamara.rn.gov.br/" target="_blank" rel="noopener">Site oficial da Prefeitura</a>
        </div>
        <div style="margin-top:10px">
                  </div>
      </section>
<style>
  .colecao-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 20px;
    padding: 20px;
    font-family: Arial, sans-serif;
  }
  .item {
    background: #fff;
    border: 1px solid #dcdcdc;
    border-radius: 6px;
    overflow: hidden;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    transition: transform 0.2s ease;
  }
  .item:hover {
    transform: translateY(-5px);
  }
  .item img {
    width: 100%;
    height: 160px;
    object-fit: cover;
  }
  .item-content {
    padding: 15px;
  }
  .item h3 {
    font-size: 18px;
    margin: 0 0 8px 0;
    color: #0c4da2;
  }
  .item p {
    font-size: 14px;
    color: #555;
    margin-bottom: 15px;
  }
  .item a {
    display: inline-block;
    padding: 8px 14px;
    background: #0c4da2;
    color: #fff;
    border-radius: 4px;
    text-decoration: none;
    font-size: 14px;
    transition: background 0.2s ease;
  }
  .item a:hover {
    background: #08397a;
  }
</style>

<div class="colecao-container">
  <div class="item">
    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQHrTZ_uyDC85dguzRjChkGlhf72dUZvZkru2x8je8D5VPgs7dPLxUF4Mo&s=10" alt="Imagem 1">
    <div class="item-content">
      <h3>Biblioteca Virtual</h3>
      <p>A biblioteca virtual oferece acesso rápido e seguro a livros, artigos e conteúdos digitais, permitindo consultas de qualquer lugar e facilitando estudos e pesquisas.
</p>
      <a href="livros.html">Acessar</a>
    </div>
  </div>
  <div class="item">
    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQzaAtz3Vc__jEx9lHzG5ZzbCoL3bPv9m-er3MjgZ8aYNOzOup5UBiQ0Qw&s=10" alt="Imagem 2">
    <div class="item-content">
      <h3>Localizar Caminhão de coleta de lixo no município</h3>
      <p>Mostra os onde está exatamente o caminhão de coleta de lixo pelas ruas do município. Você pode acompanhar de onde estiver.
</p>
      <a href="localizador.html">Acessar</a>
    </div>
  </div>
  <div class="item">
    <img src="https://us.123rf.com/450wm/bilahstudio/bilahstudio2103/bilahstudio210300554/165645817-ilustra%C3%A7%C3%A3o-vetorial-do-conceito-de-neg%C3%B3cio-erro-404-congelar-da-internet-indispon%C3%ADvel-irritado-e.jpg?ver=6" alt="Imagem 3">
    <div class="item-content">
      <h3>Em desenvolvimento.</h3>
      <p>Em desenvolvimento.</p>
      <a href="biblioteca.html">Acessar</a>
    </div>
  </div>
  <div class="item">
    <img src="https://us.123rf.com/450wm/bilahstudio/bilahstudio2103/bilahstudio210300554/165645817-ilustra%C3%A7%C3%A3o-vetorial-do-conceito-de-neg%C3%B3cio-erro-404-congelar-da-internet-indispon%C3%ADvel-irritado-e.jpg?ver=6" alt="Imagem 4">
    <div class="item-content">
      <h3>Em desenvolvimento.</h3>
      <p>Em desenvolvimento.</p>
      <a href="biblioteca.html">Acessar</a>
    </div>
  </div>
</div>






      <section class="card">
        <h2 style="margin:0 0 6px">Meus dados</h2>
        <div id="resumo"></div>
      </section>
    </div>
  </main>

  <!-- Modal Dados -->
  <div class="overlay" id="overlay">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="tituloModal">
      <div class="mhead">
        <h3 id="tituloModal">Meus dados</h3>
        <button class="mclose" id="fecharModal" aria-label="Fechar">✕</button>
      </div>
      <div style="display:grid;gap:10px;margin-top:10px">
        <div class="grid">
          <div>
            <label>Nome completo</label>
            <input id="m_nome" disabled />
          </div>
          <div>
            <label>CPF</label>
            <input id="m_cpf" disabled />
          </div>
          <div>
            <label>Data de nascimento</label>
            <input id="m_nasc" disabled />
          </div>
          <div>
            <label>Telefone (editável)</label>
            <input id="m_tel" />
          </div>
          <div>
            <label>CEP (editável)</label>
            <input id="m_cep" maxlength="9" />
          </div>
          <div>
            <label>Cidade (editável)</label>
            <input id="m_cidade" />
          </div>
          <div>
            <label>Rua (editável)</label>
            <input id="m_rua" />
          </div>
          <div>
            <label>Número (editável)</label>
            <input id="m_numero" />
          </div>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button id="btnSalvar" class="btn btn-save"><span>Salvar alterações</span></button>
        </div>
        <div id="modalMsg" style="font-size:14px;color:#5b6270"></div>
      </div>
    </div>
  </div>

  <!-- VLibras -->
  <div vw class="enabled">
    <div vw-access-button class="active"></div>
    <div vw-plugin-wrapper><div class="vw-plugin-top-wrapper"></div></div>
  </div>
  <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
  <script>new window.VLibras.Widget('https://vlibras.gov.br/app');</script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="script.js"></script>

  <!-- Script da página -->
  <script>
    // Protege a rota: se não logado, redireciona
    protegerPagina();

    const btnSair = document.getElementById('btnSair');
    btnSair.addEventListener('click', async ()=>{
      await sair();
      location.href = 'login.html';
    });

    // Preenche saudação + resumo quando auth pronta
    onAuthReady(async (user)=>{
      const perfil = await obterPerfil(user.uid);
      const primeiroNome = (perfil?.nomeCompleto||'Cidadão').split(' ')[0];
      document.getElementById('saudacao').textContent = `Olá, ${primeiroNome}!`;
      document.getElementById('resumo').innerHTML = `
        <div><strong>Nome:</strong> ${perfil?.nomeCompleto||'-'}</div>
        <div><strong>CPF:</strong> ${perfil?.cpf||'-'}</div>
        <div><strong>Nascimento:</strong> ${perfil?.nascimento||'-'}</div>
        <div><strong>Telefone:</strong> ${perfil?.telefone||'-'}</div>
        <div><strong>Endereço:</strong> ${formatEndereco(perfil?.endereco)}</div>
      `;
      // Eventos / Editais (apenas caminhos prontos)
      document.getElementById('btnEventos').href = '#/eventos-municipais';
      document.getElementById('btnEditais').href = '#/editais';
    });

    // Modal
    const overlay = document.getElementById('overlay');
    const btnDados = document.getElementById('btnDados');
    const fecharModal = document.getElementById('fecharModal');
    const modalMsg = document.getElementById('modalMsg');
    btnDados.addEventListener('click', async ()=>{
      overlay.style.display='flex';
      modalMsg.textContent='';
      const user = firebase.auth().currentUser;
      const perfil = await obterPerfil(user.uid);
      preencherModal(perfil);
    });
    fecharModal.addEventListener('click', ()=>{overlay.style.display='none'});

    function preencherModal(p){
      document.getElementById('m_nome').value = p?.nomeCompleto||'';
      document.getElementById('m_cpf').value = p?.cpf||'';
      document.getElementById('m_nasc').value = p?.nascimento||'';
      document.getElementById('m_tel').value = p?.telefone||'';
      document.getElementById('m_cep').value = p?.endereco?.cep||'';
      document.getElementById('m_cidade').value = p?.endereco?.cidade||'';
      document.getElementById('m_rua').value = p?.endereco?.rua||'';
      document.getElementById('m_numero').value = p?.endereco?.numero||'';
    }

    function formatEndereco(e){
      if(!e) return '-';
      const partes = [e.rua, e.numero && 'Nº '+e.numero, e.cidade, e.cep].filter(Boolean);
      return partes.join(', ');
    }

    // Salvar (somente telefone + endereço)
    const btnSalvar = document.getElementById('btnSalvar');
    function setSaving(is){
      btnSalvar.disabled = is;
      btnSalvar.innerHTML = is ? '<div class="spinner"></div><span>Salvando…</span>' : '<span>Salvar alterações</span>';
    }
    btnSalvar.addEventListener('click', async ()=>{
      setSaving(true); modalMsg.textContent='';
      const user = firebase.auth().currentUser;
      const dados = {
        telefone: document.getElementById('m_tel').value.trim(),
        endereco:{
          cep: document.getElementById('m_cep').value.trim(),
          cidade: document.getElementById('m_cidade').value.trim(),
          rua: document.getElementById('m_rua').value.trim(),
          numero: document.getElementById('m_numero').value.trim(),
        }
      };
      try{
        await atualizarContatoEndereco(user.uid, dados);
        modalMsg.textContent = 'Alterações salvas com sucesso.';
        const perfil = await obterPerfil(user.uid);
        document.getElementById('resumo').innerHTML = `
          <div><strong>Nome:</strong> ${perfil?.nomeCompleto||'-'}</div>
          <div><strong>CPF:</strong> ${perfil?.cpf||'-'}</div>
          <div><strong>Nascimento:</strong> ${perfil?.nascimento||'-'}</div>
          <div><strong>Telefone:</strong> ${perfil?.telefone||'-'}</div>
          <div><strong>Endereço:</strong> ${formatEndereco(perfil?.endereco)}</div>
        `;
      }catch(err){
        modalMsg.textContent = traduzErroAuth(err);
      }finally{ setSaving(false); }
    });
  </script>
</body>
</html>
<style>
  /* Fundo mais desfocado e escuro */
  #telaCarregamento {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    backdrop-filter: blur(12px);
    background: rgba(0, 0, 0, 0.55);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    transition: opacity 0.3s ease;
  }

  /* Caixa vertical estilo GOV */
  .carregandoBox {
    width: 160px;
    padding: 30px 20px;
    background: #fff;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    box-shadow: 0 6px 25px rgba(0,0,0,0.25);
    font-family: "Arial", sans-serif;
  }

  /* Bolinha girando mais profissional e suave */
  .spinner {
    width: 60px;
    height: 60px;
    border: 5px solid #0072c6;
    border-top: 5px solid transparent;
    border-radius: 50%;
    animation: girar 2.5s linear infinite; /* mais lenta e suave */
    margin-bottom: 20px;
  }

  @keyframes girar {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Texto carregando */
  .carregandoBox span {
    font-size: 17px;
    color: #0072c6;
    font-weight: bold;
    text-align: center;
  }
</style>

<div id="telaCarregamento">
  <div class="carregandoBox">
    <div class="spinner"></div>
    <span>carregando...</span>
  </div>
</div>

<script>
  setTimeout(() => {
    const tela = document.getElementById('telaCarregamento');
    tela.style.opacity = '0';
    setTimeout(() => { tela.style.display = 'none'; }, 300);
  }, 3000);
</script>
<a href="login.html" id="btnRodape">← SAIR DA CONTA</a>
<style>
  #btnRodape{
    position:fixed;
    bottom:0;
    left:0;
    right:0;
    background:var(--gov-azul,#1351B4);
    color:#fff;
    font-weight:700;
    font-size:18px;
    text-align:center;
    padding:16px;
    text-decoration:none;
    box-shadow:0 -3px 12px rgba(0,0,0,.2);
    z-index:2000;
    transition:background .25s ease;
  }
  #btnRodape:hover{
    background:#0b2b6b;
  }
</style>
